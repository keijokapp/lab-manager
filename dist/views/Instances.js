"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _react=_interopRequireDefault(require("react")),_semanticUiReact=require("semantic-ui-react"),_util=require("./util");function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}class LabRow extends _react.default.Component{constructor(){super(),this.state={loading:null}}deleteInstance(){this.state.loading||(this.setState({loading:"delete"}),fetch("lab/"+encodeURIComponent(this.props.instance.lab._id)+"/instance/"+this.props.instance.username,{method:"DELETE",headers:{"if-match":this.props.instance._rev}}).then(a=>{a.ok?window.location.reload():this.setState({loading:null})}).catch(()=>{this.setState({loading:null})}))}render(){const a=this.props.instance,b=new Date(a.startTime),c=[];for(const b in a.lab.repositories)c.push(_react.default.createElement("p",{key:b},b," (",a.lab.repositories[b].name,a.lab.repositories[b].head&&"/"+a.lab.repositories[b].head,")"));return _react.default.createElement(_semanticUiReact.Table.Row,null,_react.default.createElement(_semanticUiReact.Table.Cell,null,a.lab._id),_react.default.createElement(_semanticUiReact.Table.Cell,null,a.username),_react.default.createElement(_semanticUiReact.Table.Cell,null,"assistant"in a.lab?a.lab.assistant.url:_react.default.createElement("i",null,"None")),_react.default.createElement(_semanticUiReact.Table.Cell,null,"machines"in a?a.lab.machineOrder.map(b=>_react.default.createElement("p",{key:b},a.machines[b].name," (",a.lab.machines[b].description,")")):_react.default.createElement("i",null,"None")),_react.default.createElement(_semanticUiReact.Table.Cell,{singleLine:!0},c.length?c:_react.default.createElement("i",null,"None")),_react.default.createElement(_semanticUiReact.Table.Cell,null,"endpoints"in a?a.lab.endpoints.map(b=>_react.default.createElement("p",{key:b},_react.default.createElement("a",{href:a.endpoints[b].link,target:"_blank"},b))):_react.default.createElement("i",null,"None")),_react.default.createElement(_semanticUiReact.Table.Cell,{singleLine:!0},_react.default.createElement("p",null,b.toDateString()+" "+b.toTimeString().split(" ")[0]),_react.default.createElement("p",null,_react.default.createElement(_util.TimeSince,{date:b})," ago")),_react.default.createElement(_semanticUiReact.Table.Cell,null,_react.default.createElement("a",{href:"lab/"+encodeURIComponent(a.lab._id)+"/instance/"+encodeURIComponent(a.username)},"Details")),_react.default.createElement(_semanticUiReact.Table.Cell,{collapsing:!0},_react.default.createElement(_semanticUiReact.Popup,{on:"click",position:"top center",wide:!0,hideOnScroll:!0,trigger:_react.default.createElement(_semanticUiReact.Button,{negative:!0,disabled:!!this.state.loading,loading:"delete"===this.state.loading,icon:!0},_react.default.createElement(_semanticUiReact.Icon,{name:"trash"})," Delete")},_react.default.createElement(_semanticUiReact.Button,{negative:!0,onClick:()=>this.deleteInstance()},"Confirm deletion"))))}}class Instances extends _react.default.Component{constructor(a){super();const b={};for(const c of a.instances)b[c._id]={lab:c.lab._id,username:c.username,assistant:"assistant"in c.lab?c.lab.assistant.url:"",machines:"machineOrder"in c.lab?c.lab.machineOrder.length:0,repositories:"endpoints"in c.lab?c.lab.endpoints.length:0,endpoints:"endpoints"in c.lab?c.lab.endpoints.length:0,startTime:c.startTime};this.state={instances:a.instances,derivedDataCache:b,loading:null,column:null,direction:null}}handleSort(a){return()=>{this.state.column===a?this.setState({instances:this.state.instances.reverse(),direction:"ascending"===this.state.direction?"descending":"ascending"}):this.setState({column:a,instances:this.state.instances.slice().sort((b,c)=>this.state.derivedDataCache[b._id][a]-this.state.derivedDataCache[c._id][a]),direction:"ascending"})}}render(){const a=[];for(const b of this.state.instances)a.push(_react.default.createElement(LabRow,{key:b._id,instance:b}));const{direction:b,column:c}=this.state;return _react.default.createElement(_semanticUiReact.Grid,null,_react.default.createElement(_semanticUiReact.Grid.Column,null,_react.default.createElement(_semanticUiReact.Header,{size:"large",color:"teal"},"Running Labs"),_react.default.createElement(_semanticUiReact.Table,{sortable:!0},_react.default.createElement(_semanticUiReact.Table.Header,null,_react.default.createElement(_semanticUiReact.Table.Row,null,_react.default.createElement(_semanticUiReact.Table.HeaderCell,{sorted:"lab"===c?b:null,onClick:this.handleSort("lab")},"Lab"),_react.default.createElement(_semanticUiReact.Table.HeaderCell,{sorted:"username"===c?b:null,onClick:this.handleSort("username")},"Username"),_react.default.createElement(_semanticUiReact.Table.HeaderCell,{sorted:"assistant"===c?b:null,onClick:this.handleSort("assistant")},"Assistant"),_react.default.createElement(_semanticUiReact.Table.HeaderCell,{sorted:"machines"===c?b:null,onClick:this.handleSort("machines")},"Machines"),_react.default.createElement(_semanticUiReact.Table.HeaderCell,{sorted:"repositories"===c?b:null,onClick:this.handleSort("repositories")},"Repositories"),_react.default.createElement(_semanticUiReact.Table.HeaderCell,{sorted:"endpoints"===c?b:null,onClick:this.handleSort("endpoints")},"Endpoints"),_react.default.createElement(_semanticUiReact.Table.HeaderCell,{sorted:"startTime"===c?b:null,onClick:this.handleSort("startTime")},"Start time"),_react.default.createElement(_semanticUiReact.Table.HeaderCell,{colSpan:"2"}))),_react.default.createElement(_semanticUiReact.Table.Body,null,a))))}}exports.default=Instances;